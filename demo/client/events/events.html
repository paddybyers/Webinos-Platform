<html>
<head>
	<title>webinos events</title>
	<script type="text/javascript" src="/client/webinos.js"></script>
	<script type="text/javascript"
		src="http://code.jquery.com/jquery-1.5.2.js"></script>
	<script type="text/javascript">

	function logObj(obj, name){
		for (var myKey in obj){
			console.log(name + "["+myKey +"] = "+obj[myKey]);
			if (typeof obj[myKey] == 'object') logObj(obj[myKey], name + "." + myKey);
		}
	}
	
            $(document).ready(function() {
            	    foundEventAPIs = [];
                    $('#findService').bind('click', function() {
                	    webinos.ServiceDiscovery.findServices(new ServiceType('http://webinos.org/api/events'), 
						{onFound: function (service) {
                	    	foundEventAPIs.push(service);
                	    	$('#messages').append('<li> EventAPI found: ' + service.api + '</li>');

                	    	logObj(service, "Service");
                	    }});
                    });
                    
                    $('#cls').bind('click', function() {
                    	document.getElementById("messages").innerHTML = "";
                    }); 
                    
                    $('#bind').bind('click', function() {
                        for (var i = 0; i < foundEventAPIs.length; i++){
                        	var act = i;
                        	foundEventAPIs[act].bind(function(){
                        		
                        		logObj(foundEventAPIs,"foundEventAPIs");
                        		$('#messages').append('<li> Events API ' + foundEventAPIs[act].api + ' bound.</li>');
                        		$('#messages').append('<li> My APP ID ' + foundEventAPIs[act].temporaryRandomAppID + ' </li>');
                           	});
                        }
            	    	
                    }); 
                    
                    
                    $('#create').bind('click', function() {
                    	for (var i = 0; i < foundEventAPIs.length; i++){
                    		var act = i;
                    		foundEventAPIs[act].createWebinosEvent();
                        }
            	    	
                    });
                    
                    $('#register').bind('click', function() {
                    	for (var i = 0; i < foundEventAPIs.length; i++){
                    		var act = i;
                    		foundEventAPIs[act].addWebinosEventListener(function (event) {
                    			console.log("New event received");
                    			
                    			$("#textIn").val(event.payload);
                    			
                    			logObj(event,"event");
                    		});
                        }
                     }); 
                     
                     $('#remove').bind('click', function() {
                    	for (var i = 0; i < foundEventAPIs.length; i++){
                    		var act = i;
                    		foundEventAPIs[act].removeWebinosEventListener();
                        }
                     });
                     
                     $('#send').bind('click', function() {
                    	for (var i = 0; i < foundEventAPIs.length; i++){
                    		var act = i;
                    		var ev = foundEventAPIs[act].createWebinosEvent();
                    		
                    		ev.payload = $("#textOut").val();
                    		console.log(ev.payLoad);
                    		
                    		
                    		var callback = {};
		
			callback.onSending = function (params) {
			//params.event, params.recipient
				
				$('#messages').append('<li> onSending()</li>');
			};
			callback.onCaching = function (params) {
				//params.event
				$('#messages').append('<li> onCaching()</li>');
			};
			callback.onDelivery = function (params) {
			//params.event, params.recipient
				$('#messages').append('<li> onDelivery()</li>');
			};
			callback.onTimeout = function (params) {
			//params.event, params.recipient
				$('#messages').append('<li> onTimeout()</li>');
			};
			callback.onError = function (params) {
			//params.event, params.recipient, params.error
				$('#messages').append('<li> onError()</li>');
			};
                    		
                    		ev.dispatchWebinosEvent(callback);
                        }
                     });  

            });
        </script>
     
</head>
<body>
	<div >
		<div >
			<p>
				<div> PZH PZP LIST : <select id="pzh_pzp_list"> <option> </option> </select> <br> </div>
				<button id="cls">Clear</button><button id="findService">Find Eventing Service</button>
				
				<button id="bind">Bind</button>
		    	<button id="create">Create Event</button>
		    	<button id="register">Register Event Listener</button>
		    	<button id="remove">Remove Event Listener</button>
		    	<button id="send">Send Event</button>
			</p>
			<p><div style="color:#ffffff;">
				1. Press "Find Eventing Service" Button
			to get the Eventing Service<br>2. Press "Bind" button to bind the found service. This also makes the running App (this demo page) known to the eventing serivce<br>3. Press "Register Event Listener" Button to register for incoming events (currently all events will be received, filters and options are to do)<br>4. Type in a message in the left box and press "send" button. The message will be send to the PZP, the PZP propagates the message to subscribers and then the message will be displayed in the right box. You may open this demo page several times (including find, bind, and register) to do chatting between multiple applications<br></p>
			</div><p>
				<textarea id="textOut" rows="5" cols="40">Type your Message here</textarea>
				<textarea id="textIn" rows="5" cols="40" readonly>Incoming Messages will appear here</textarea>
			</p>
			<p>
				<ul id="sensorResult">
                   <br><br>
			</ul>
			</p>
		</div>
		<div >
			<ul id="messages">
			</ul>
		</div>
	</div>
</body>
</html>
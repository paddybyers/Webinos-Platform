<html>
<head>
	<title>webinos events</title>
	<script type="text/javascript" src="/client/webinos.js"></script>
	<script type="text/javascript"
		src="http://code.jquery.com/jquery-1.5.2.js"></script>
	<script type="text/javascript">

	function logObj(obj, name){
		for (var myKey in obj){
			console.log(name + "["+myKey +"] = "+obj[myKey]);
			if (typeof obj[myKey] == 'object') logObj(obj[myKey], name + "." + myKey);
		}
	}
	var address;
	
            $(document).ready(function() {
            	    sensors = [];
                    $('#findService').bind('click', function() {
						address = $('#pzh_pzp_list').val();

                	    webinos.ServiceDiscovery.findServices(address, new ServiceType('http://webinos.org/api/events'), 
						{onFound: function (service) {
                	    	sensors.push(service);
                	    	$('#messages').append('<li> New Sensor found: ' + service.api + '</li>');

                	    	logObj(service, "Service");
                	    }});
                    });
                    
                    $('#cls').bind('click', function() {
                    	document.getElementById("messages").innerHTML = "";
                    }); 
                    
                    $('#bind').bind('click', function() {
                        for (var i = 0; i < sensors.length; i++){
                        	var act = i;
                        	sensors[act].bind(function(){
                        		
                        		logObj(sensors,"sensors");
                        		$('#messages').append('<li> Sensor ' + sensors[act].api + ' bound.</li>');
                           	});
                        }
            	    	
                    }); 
                    
                    
                    $('#create').bind('click', function() {
                    	for (var i = 0; i < sensors.length; i++){
                    		var act = i;
                    		sensors[act].createWebinosEvent();
                        }
            	    	
                    });
                    
                    $('#register').bind('click', function() {
                    	for (var i = 0; i < sensors.length; i++){
                    		var act = i;
                    		sensors[act].addWebinosEventListener();
                        }
                     }); 
                     
                     $('#remove').bind('click', function() {
                    	for (var i = 0; i < sensors.length; i++){
                    		var act = i;
                    		sensors[act].removeWebinosEventListener();
                        }
                     }); 

            });
        </script>
     
</head>
<body>
	<div >
		<div >
			<p>
				<div> PZH PZP LIST : <select id="pzh_pzp_list"> <option> </option> </select> <br> </div>
				<button id="findService">Find Eventing Service</button>
				<button id="cls">Clear</button>
				<button id="bind">Bind</button>
		    	<button id="create">Create Event</button>
		    	<button id="register">Register Event Listener</button>
		    	<button id="remove">Remove Event Listener</button>
			</p>
			<p>
				<ul id="sensorResult">
                   <br><br><br><br><br><br><br><br>
			</ul>
			</p>
		</div>
		<div >
			<ul id="messages">
			</ul>
		</div>
	</div>
</body>
</html>
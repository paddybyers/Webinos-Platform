<!DOCTYPE html>
<html dir="ltr" lang="en-US">
	<head>
		<title>Webinos Local Discovery Prototype</title>
		
		<link rel="stylesheet" type="text/css" href="GuiElements/demoPage/style.css" media="screen"/>
	<!--	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script> -->
<script type="text/javascript" src="./jquery-1.4.2.min.js"></script>
		<script src="http://localhost:8000/socket.io/socket.io.js"></script>
		
	</head>
	<body>	
	<div id="content">	
		<div id="header">
		<h1><img src="GuiElements/demoPage/testbed_logo.png"> 	</h1> 
		</div>
		<div id="functions">	
		<h2>Testfunctions:</h2>
	    <h3> Discover Device and Service </h3>
			<p>
            <!--<select id='servicelist' size="8" multiple="multiple">-->
			<select id='servicelist'>
				<option>Pull down and select a service </option>
				<OPTION VALUE="0x1106"          >FileService
				<OPTION VALUE="0x1108"          >HeadsetService
				<OPTION VALUE="0x1109"          >CordlessService
				<OPTION VALUE="0x110A"          >AudioSourceService
			</select><br/>
		    <INPUT TYPE="submit" onclick="discoverdevice()" VALUE="Find Device with Selected Service" class="button" /><br />
			<INPUT TYPE="submit" onclick="bindservice()" VALUE="Bind with device and service" class="button" /><br />
			
			<h3> Use Discovered service</h3>
			<!--<INPUT TYPE="submit" onclick="listfile()" VALUE="Get filelist" class="button" /><br />-->
			<INPUT TYPE="submit" onclick="listfile()" VALUE="Open Folder" class="button" /><br />
			<INPUT TYPE="submit" onclick="upfolder()" VALUE="Go Back to Parent Folder" class="button" /><br />
			<INPUT TYPE="submit" onclick="getfile()" VALUE="Get File" class="button" /><br />
			<INPUT TYPE="submit" onclick="playfile()" VALUE="play file" class="button" /><br />
			<div id="loader"></div>

		</p>
    </div>
    
				
		<script type="text/javascript" src="DiscoveryClient.js"></script>
		
		
		<p> Found devices supporting service  :</p>
	
		<select id='devicelist' size="6" multiple="multiple">

        <OPTION VALUE="Select a device below to bind">Select a device below to bind</OPTION>

		</select><br/>

	    <!--<INPUT TYPE="submit" onclick="bindservice()" VALUE="Bind with device and service"></p>-->
		<p> Folder list :</p>
		
		<!-- <select id='folderlist'> -->
	
		<select id='folderlist' size="7" multiple="multiple">

        <OPTION VALUE="Select a folder below">Select a folder below</OPTION>

		</select>
	     
		
		<p> File list :</p>
	
		<select id='filelist' size="10" multiple="multiple">

        <OPTION VALUE="Select a file below">Select a file below</OPTION>
		</select>
		
		<hr />
	    <p>Contacts:</p>
	    <a
		href="mailto:alan.baldwin@samsung.com">alan.baldwin@samsung.com</a>
		or
		<a
		href="mailto:ziran.sun@samsung.com">ziran.sun@samsung.com</a> 
			
	</body>
	
	<script type="text/javascript">
	
		function changeHandler(event)
		{
			var index;
			index = this.selectedIndex;

			if (index >= 0 && this.options.length > index)
			{
				// Get the new value
  				selected = this.options[index].value;
 			}
     		return selected;
		}
		
		if (servicelist.addEventListener) 
		{
  			// DOM2 standard
  			servicelist.addEventListener("change", changeHandler, false);
		}
		else if (service.attachEvent) 
		{
  			// IE fallback
  			servicelist.attachEvent("onchange", changeHandler);
		}
		else 
		{
  			// DOM0 fallback
  			servicelist.onchange = changeHandler;
		}

		if (devicelist.addEventListener) 
		{
  			// DOM2 standard
  			devicelist.addEventListener("change", changeHandler, false);
		}
		else if (devicelist.attachEvent) 
		{
  			// IE fallback
  			devicelist.attachEvent("onchange", changeHandler);
		}
		else 
		{
  			// DOM0 fallback
  			devicelist.onchange = changeHandler;
		}
		
		if (folderlist.addEventListener) 
		{
  			// DOM2 standard
  			folderlist.addEventListener("change", changeHandler, false);
		}
		else if (folderlist.attachEvent) 
		{
  			// IE fallback
  			folderlist.attachEvent("onchange", changeHandler);
		}
		else 
		{
  			// DOM0 fallback
  			folderlist.onchange = changeHandler;
		}		
		
		if (filelist.addEventListener) 
		{
  			// DOM2 standard
  			filelist.addEventListener("change", changeHandler, false);
		}
		else if (filelist.attachEvent) 
		{
  			// IE fallback
  			filelist.attachEvent("onchange", changeHandler);
		}
		else 
		{
  			// DOM0 fallback
  			filelist.onchange = changeHandler;
		}		
		
		function discoverdevice()
		{
			var serviceType = document.getElementById('servicelist').value;
			console.log("serviceType:" + serviceType); 
			
			$('#loader').html("<img src='GuiElements/demoPage/ajaxloader.gif'>");
	
			//webinos.rpc.findServices(serviceType, {onFound: function (results) {		
			webinos.rpc.findServices(serviceType);			
		}
		
		function bindservice(){
		
			$('#loader').html("<img src='GuiElements/demoPage/ajaxloader.gif'>");	
			var device = document.getElementById('devicelist').value;
		    alert("You've chosen to bind service in device  " + device + "and see the root folder list");
		    
		    //only need MAC address 
			var addresses = device.split(",");
			console.log("addresses[1]" + addresses[1]);
		    //connect the device
		    webinos.rpc.bindsevice(addresses[1]);
		}	
		
		function listfile()
		{
			
			var val = document.getElementById('filelist');
			emptyList(filelist);
			
			
			var device = document.getElementById('devicelist').value;
			var addresses = device.split(",");
			device = addresses[1];
			console.log("device:" + device);
			var dir = document.getElementById('folderlist').value;
			
			if(dir === "Select a folder below")
			{
			  alert(" you need to select a folder in the folder list for this operation");
			
			}
			else
			{	$('#loader').html("<img src='GuiElements/demoPage/ajaxloader.gif'>");
				alert("Make sure that your files are bluetooth visible. e.g. enable Bluetooth visibility");
				console.log("folder:" + dir);
				var data = [];
				data[0] = device;
				data[1] = dir; 
				getfilelist(data);
			}
		}
		
		function upfolder()
		{	
			var device = document.getElementById('devicelist').value;
			var addresses = device.split(",");
			device = addresses[1];
			var currentfolder = document.getElementById('folderlist').value;
			console.log("currentfolder:" + currentfolder);
			if(currentfolder === "Select a folder below")
			{
			  alert(" you need to select a folder in the folder list for this operation");
			
			}
			else
			{
				var index = currentfolder.lastIndexOf("/");
				if(index !==0)
				{
					var parentfolder = currentfolder.substring(0, index);
					var index2 = parentfolder.lastIndexOf("/");
					console.log("index2:" + index2);
					if(index2 === 0)
					{
						parentfolder = "/";
					}
					else
					{
						parentfolder = parentfolder.substring(0, index2);
					}
					console.log("parentfolder:" + parentfolder);
				
					var data = [];
					data[0] = device;
					data[1] = parentfolder;
					getfilelist(data);
					var val = document.getElementById('filelist');
					emptyList(filelist);
				}
			}
		}
		
		
		function getfile()
		{
			$('#loader').html("<img src='GuiElements/demoPage/ajaxloader.gif'>");
			var device = document.getElementById('devicelist').value;
			var addresses = device.split(",");
			device = addresses[1];	
			//var dir = document.getElementById('folderlist').value;
			var selectedFile = document.getElementById('filelist').value;
			//var str1 = "/";
			
			var data = [];
			data[0] = device;
			
			data[1] = selectedFile;
			console.log("selectedFile: " + selectedFile); 
			
			var index= selectedFile.lastIndexOf("/");
			data[2] = selectedFile.substring(index+1, selectedFile.length);
			console.log("data[2]", data[2]);
			
			//selectedfile=str1.concat(selectedFile);
			//data[1] = str1.concat(dir.concat(selectedfile));
			
			console.log("file:" + data[1]);
			
			transferfile(data); 
		}
		
		function playfile()
		{
		  var selectedFile = document.getElementById('filelist').value;
		  console.log("selectedFile:" + selectedFile);
		  // var str1 = "http://106.1.9.17:8000/";
		  var str1 = "http://localhost:8000/";
		  
		  var index= selectedFile.lastIndexOf("/");
		  filetransferred = selectedFile.substring(index+1, selectedFile.length);
		  
		  newwindow=window.open(str1.concat(filetransferred),'name','height=400,width=300');
		  if (window.focus) {newwindow.focus()}
		  
        }
		
	</script>
	
</html>



<html>
<head>
<title>webinos rpc</title>
<script type="text/javascript" src="/rpc.js"></script>
	<script type="text/javascript" src="/client/webinos.js"></script>
	<script type="text/javascript" src="/client/get42.js"></script>
	<script type="text/javascript" src="/client/webinos.sensors.js"></script>
	<script type="text/javascript"
		src="http://code.jquery.com/jquery-1.5.2.js"></script>
	<script type="text/javascript">

	function logObj(obj, name){
		for (var myKey in obj){
			console.log(name + "["+myKey +"] = "+obj[myKey]);
			if (typeof obj[myKey] == 'object') logObj(obj[myKey], name + "." + myKey);
		}
	}
	
            $(document).ready(function() {
            		var reader = null;
            	    var fileSaver = null;
            	    var fileWriter = null;
            	    var test = null;
            	    

            	    
            	    var sensors = [];
                    $('#findService').bind('click', function() {
                	    webinos.ServiceDiscovery.findServices("Sensors", {onFound: function (service) {
                	    	sensors.push(service);
                	    	$('#messages').append('<li> New Sensor found: ' + service.api + '</li>');
                	    	logObj(service, "Service");
                	    }});
                	    
                	   // webinos.ServiceDiscovery.findServices("Test", {onFound: function (service) {
                	    //	test = service;
                	    	//logObj(service,"Test");
                	    //}});
                    });
                    
                    $('#get42').bind('click', function() {
                    	test.get42(function (result){
                    		alert(result);
                    		alert(test.testAttr);
                    	});
                    }); 
                    
                    $('#cls').bind('click', function() {
                    	document.getElementById("messages").innerHTML = "";
                    	document.getElementById("fileContent").value = "";
                    }); 
                    
                    $('#bind').bind('click', function() {
                        for (var i = 0; i < sensors.length; i++){
                        	sensors[i].bind(function(){
                        		$('#messages').append('<li> Sensor ' + sensors[i].api + ' bound.</li>');
                        	});
                        }
            	    	
                    }); 
                    
                    
                    $('#configure').bind('click', function() {
                    	for (var i = 0; i < sensors.length; i++){
                        	sensors[i].configureSensor({}, function(){
                        		$('#messages').append('<li> Sensor ' + sensors[i].api + ' configured.</li>');
                        	},
                        	function (){
                        		$('#messages').append('<li> Error configuring Sensor ' + sensors[i].api + '</li>');
                        	});
                        }
            	    	
                    });
                    
                    $('#fileWriter').bind('click', function() {
                    	fileWriter.bind(function () {
                     	   
                      	    webinos.ServiceDiscovery.findServices("BlobBuilder", {onFound: function (service) {
                    	    
                      	      var fileName = $('#messageText').val();
                        	   
                      	    service.append(document.getElementById("fileContent").value);
                        	   var tmp = fileWriter.writeAs(fileName);
                        	   
                        	   tmp.onwriteend = function () {
                        		   $('#messages').append('<li> Writing done.</li>'); 
                        	   };
                        	   
                        	   tmp.onwritestart = function () {
                        		   $('#messages').append('<li> Writing started.</li>');
                        	   };
                        	   
                        	   tmp.onwrite = function () {
                        		   $('#messages').append('<li> Writing...</li>');
                        	   };
                        	   
                        	   tmp.onerror = function (error) {
                        		   $('#messages').append('<li> Writing error! Code: ' + error.code + '</li>');
                        	   };
                        	   
                        	   $('#messages').append('<li> Accessing FileWriter Constants (INIT, WRITING, DONE, readyState): '
                        			   + tmp.INIT + ' '
                        			   + tmp.WRITING + ' '
                        			   + tmp.DONE + ' '
                        			   + tmp.readyState + ' '
                        			   + '</li>'); 
                         	   
                        	   tmp.write(service.getBlob());
                    	    }});
                        });
                     }); 
                    
                    $('#fileWriterTruncate').bind('click', function() {
                    	fileWriter.bind(function () {
                     	   
                      	    webinos.ServiceDiscovery.findServices("BlobBuilder", {onFound: function (service) {
                    	    
                      	      var fileName = $('#messageText').val();
                        	   
                      	    service.append(document.getElementById("fileContent").value);
                        	  
                      	    var tmp = fileWriter.writeAs(fileName);
                        	   
                        	   tmp.onwriteend = function () {
                        		   $('#messages').append('<li> Truncate done.</li>'); 
                        	   };
                        	   
                        	   tmp.onwritestart = function () {
                        		   $('#messages').append('<li> Truncate started.</li>');
                        	   };
                        	   
                        	   tmp.onwrite = function () {
                        		   $('#messages').append('<li> Truncateing...</li>');
                        	   };
                        	   
                        	   tmp.onerror = function (error) {
                        		   $('#messages').append('<li> Truncate error: ' + error.target.error.name + '</li>');
                        	   };
                        	   
                        	   tmp.truncate($('#truncate').val());
                    	    }});
                        });
                     }); 
            });
        </script>
     
</head>
<body>
	<div >
		<div >
			<p>
				<button id="findService">Find Sensors</button>
				<button id="get42">get42</button>
				<button id="cls">Clear</button>
				<button id="bind">Bind Sensors</button>
		    	<button id="configure">Configure Sensors</button>
		    	<button id="fileWriter">Save with FileWriter</button>
		    	<button id="fileWriterTruncate">Truncate</button>
		     	<input type="text" id="truncate" />
			</p>
			<p>
				<label for="messageText">File Name</label> <input type="text"
					id="messageText" />
					<br>
				<label for="fileContent">File Content</label> 
				<br>
				<textarea rows='8' size = 500
					id="fileContent">
					</textarea>
			</p>
		</div>
		<div >
			<ul id="messages">
			</ul>
		</div>
	</div>
</body>
</html>
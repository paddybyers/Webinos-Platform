<html>
<head>
<title>webinos session messaging rpc</title>
	<script type="text/javascript" src="/rpc.js"></script>
	<link rel="stylesheet" type="text/css" href="/jquery-ui-1.8.16.custom.css"/>
	<script type="text/javascript" src="/jquery.js"></script>
	<script type="text/javascript" src="/jquery-ui.js"></script>
	<!--<link rel="stylesheet" type="text/css" href="style.css" media="screen"/>-->
	<script type="text/javascript" src="/client/webinos.js"></script>
	<script type="text/javascript" src="/webinos.utils.js"></script>
	<script type="text/javascript" src="/client/webinos.file.js"></script>
	<script type="text/javascript" src="/messaging.js"></script>
	<script type="text/javascript" src="/client/get42.js"></script>
	<!--<script type="text/javascript" src="/jquery.js"></script>-->
	<script type="text/javascript" src="/dojo.js"></script>

	<script type="text/javascript">
		$(document).ready(function() {
			$("#tabs").tabs();
        	var reader = null;
            var fileSaver = null;
            var fileWriter = null;
            var test = null;
            var geoLocationService = null;
            $('#startPZH').bind('click', function() {
				var config = 'country='+ document.getElementById('country').value + '\n' +
						'state='+ document.getElementById('state').value + '\n' +
						'city='+ document.getElementById('city').value + '\n' +
						'organization='+ document.getElementById('org').value + '\n' +
						'organizationUnit='+ document.getElementById('orgunit').value + '\n' +
						'common='+ document.getElementById('common').value + '\n' +
						'email='+ document.getElementById('email').value + '\n' +
						'days='+ document.getElementById('days').value + '\n';
				var payload = {status: 'startPZH', 
							servername: document.getElementById('servername').value, 
							serverport: document.getElementById('serverport').value, 
							httpserver: document.getElementById('httpport').value,
							value: config}; 
						var options = {type: 'prop', payload: payload};
						webinos.send(options);                	   
                    });

                   $('#startPZP').bind('click', function() {
						var config = 'country='+ document.getElementById('pzpcountry').value + '\n' +
						'state='+ document.getElementById('pzpstate').value + '\n' +
						'city='+ document.getElementById('pzpcity').value + '\n' +
						'organization='+ document.getElementById('pzporg').value + '\n' +
						'organizationUnit='+ document.getElementById('pzporgunit').value + '\n' +
						'common='+ document.getElementById('pzpcommon').value + '\n' +
						'email='+ document.getElementById('pzpemail').value + '\n' +
						'days='+ document.getElementById('pzpdays').value + '\n';
						
						var payload = {status: 'startPZP', 
								servername: document.getElementById('pzpservername').value,
								serverport: document.getElementById('pzpserverport').value,
								pzpserverport: document.getElementById('pzpport').value,
								value: config}; 
						var options = {type: 'prop', payload: payload};
						webinos.send(options);
                    });

                    $('#registerBrowser').bind('click', function() {
						var payload = {status: 'registerBrowser'}; 
						var options = {type: 'prop', payload: payload};
						webinos.send(options);   
                    });
		  
				   $('#otherPZH').bind('click', function() {
						var payload = {status: 'otherPZH', 
								servername: document.getElementById('otherpzhservername').value,
								serverport: document.getElementById('otherpzhserverport').value}; 
						var options = {type: 'prop', payload: payload};
						webinos.send(options);
                    });
		  
                    $('#findService').bind('click', function() {
                	    webinos.ServiceDiscovery.findServices("FileReader", {onFound: function (service) {
                	    	reader = service;
                	    }});
                	    webinos.ServiceDiscovery.findServices("FileSaver", {onFound: function (service) {
                	    	fileSaver = service;
                	    }});
                	    webinos.ServiceDiscovery.findServices("FileWriter", {onFound: function (service) {
                	    	fileWriter = service;
                	    }});
                	    webinos.ServiceDiscovery.findServices("Test", {onFound: function (service) {
                	    	test = service;
                	    }});
                	    webinos.ServiceDiscovery.findServices("Geolocation", {onFound: function (service) {
                	    	geoLocationService = service;
                	    }});
                	   
                    });
                    
                    $('#get42PZP').bind('click', function() {
                    	test.get42PZP(function (result){
                    		alert('result '+result);
                    		alert('test '+test.testAttr);
                    	});
                    }); 
                     
					$('#get42PZPtoPZH').bind('click', function() {
                    	test.get42PZPtoPZH(function (result){
                    		alert('result '+result);
                    		alert('test '+test.testAttr);
                    	});
                    });                     
                    
					$('#get42PZPtoPZHtoPZP').bind('click', function() {
                    	test.get42PZPtoPZHtoPZP(function (result){
                    		alert('result '+result);
                    		alert('test '+test.testAttr);
                    	});
                    });

				   $('#get42PZPtoPZHtoPZH').bind('click', function() {
								test.get42PZPtoPZHtoPZH(function (result){
									alert('result '+result);
									alert('test '+test.testAttr);
								});
							});
				 
				   $('#get42PZPtoPZHtoPZHtoPZP').bind('click', function() {
								test.get42PZPtoPZHtoPZHtoPZP(function (result){
									alert('result '+result);
									alert('test '+test.testAttr);
								});
							});
						   
					});
			
                    $('#echo').bind('click', function() {
                    	test.echoAttr.echo(document.getElementById("fileContent").value, function (result){
                    		alert(result);
                    	});
                    }); 

                   $('#currentPositionButton').bind('click', function() {
                    	geoLocationService.getCurrentPosition(function (result){
                    		//var resarray = JSON.parse(result);
                    		// var loc= 'Latitude = ' + resarray['latitude'] + ', longitude = ' + resarray['longitude'];
                    		alert(result);
                    	});
                    }); 

                    
                    $('#cls').bind('click', function() {
                    	document.getElementById("messages").innerHTML = "";
                    	document.getElementById("fileContent").value = "";
                    }); 
                    
                    $('#getFileContent').bind('click', function() {
                       reader.bind(function () {
                       //var reader = new webinos.WebinosFileReader();
                       		reader.readAsText($('#messageText').val());
                       		reader.onload = function (result) {
                       			reader.unbind();
            	    			//$('#messages').append('<li>Result: ' + result + '</li>');
                       			document.getElementById("fileContent").value = result;
                       			$('#messages').append('<li>Got Reader Result (see box)</li>');
            	    		};
                       		reader.onerror = function (error) {
                       			reader.unbind();
               	    			$('#messages').append('<li>Result: Error Code: ' +  error + '</li>');
            	    		};
            	    	
                       });
            	    	
            	    	$('#messages').append('<li> Requesting file Read</li>');
                    }); 
                    
                    
                    $('#fileSaver').bind('click', function() {
                       fileSaver.bind(function () {
                    	   
                    	   webinos.ServiceDiscovery.findServices("BlobBuilder", {onFound: function (service) {
                    	   
                    	   var fileName = $('#messageText').val();
                    	   
                    	   service.append(document.getElementById("fileContent").value);
                    	   var tmp = fileSaver.saveAs(service.getBlob(),fileName);
                    	   service.append(" Arbritrary appendix to given text.");
                    	   //var tmp2 = fileSaver.saveAs(service.getBlob(),fileName + "2");
                    	   
                    	   tmp.onwriteend = function () {
                    		   $('#messages').append('<li> Writing done.</li>'); 
                    	   };
                    	   /*
                    	   tmp2.onwriteend = function () {
                    		   $('#messages').append('<li> Writing done 2.</li>'); 
                    	   };*/
                    	   
                    	   tmp.onwritestart = function () {
                    		   $('#messages').append('<li> Write started.</li>');
                    	   };
                    	   
                    	   tmp.onwrite = function () {
                    		   $('#messages').append('<li> Writing...</li>');
                    	   };
                    	   
                    	   tmp.onerror = function (error) {
                    		   $('#messages').append('<li> Writing error! Code: ' + error.code + '</li>');
                    	   };
                    	   
                    	   $('#messages').append('<li> Accessing FileSaver Constants (INIT, WRITING, DONE, readyState): '
                    			   + tmp.INIT + ' '
                    			   + tmp.WRITING + ' '
                    			   + tmp.DONE + ' '
                    			   + tmp.readyState + ' '
                    			   + '</li>'); 
                    	   }});
                       });
                    });
                    
                    $('#fileWriter').bind('click', function() {
                    	fileWriter.bind(function () {
                     	   
                      	    webinos.ServiceDiscovery.findServices("BlobBuilder", {onFound: function (service) {
                    	    
                      	      var fileName = $('#messageText').val();
                        	   
                      	    service.append(document.getElementById("fileContent").value);
                        	   var tmp = fileWriter.writeAs(fileName);
                        	   
                        	   tmp.onwriteend = function () {
                        		   $('#messages').append('<li> Writing done.</li>'); 
                        	   };
                        	   
                        	   tmp.onwritestart = function () {
                        		   $('#messages').append('<li> Writing started.</li>');
                        	   };
                        	   
                        	   tmp.onwrite = function () {
                        		   $('#messages').append('<li> Writing...</li>');
                        	   };
                        	   
                        	   tmp.onerror = function (error) {
                        		   $('#messages').append('<li> Writing error! Code: ' + error.code + '</li>');
                        	   };
                        	   
                        	   $('#messages').append('<li> Accessing FileWriter Constants (INIT, WRITING, DONE, readyState): '
                        			   + tmp.INIT + ' '
                        			   + tmp.WRITING + ' '
                        			   + tmp.DONE + ' '
                        			   + tmp.readyState + ' '
                        			   + '</li>'); 
                         	   
                        	   tmp.write(service.getBlob());
                    	    }});
                        });
                     }); 
                    
                    $('#fileWriterTruncate').bind('click', function() {
                    	fileWriter.bind(function () {
                     	   
                      	    webinos.ServiceDiscovery.findServices("BlobBuilder", {onFound: function (service) {
                    	    
                      	      var fileName = $('#messageText').val();
                        	   
                      	    service.append(document.getElementById("fileContent").value);
                        	  
                      	    var tmp = fileWriter.writeAs(fileName);
                        	   
                        	   tmp.onwriteend = function () {
                        		   $('#messages').append('<li> Truncate done.</li>'); 
                        	   };
                        	   
                        	   tmp.onwritestart = function () {
                        		   $('#messages').append('<li> Truncate started.</li>');
                        	   };
                        	   
                        	   tmp.onwrite = function () {
                        		   $('#messages').append('<li> Truncateing...</li>');
                        	   };
                        	   
                        	   tmp.onerror = function (error) {
                        		   $('#messages').append('<li> Truncate error: ' + error.target.error.name + '</li>');
                        	   };
                        	   
                        	   tmp.truncate($('#truncate').val());
                    	    }});
                        });
                     }); 
            

        </script>
        <script type="text/javascript">
	dojo.require("dojo.hash");

	dojo.addOnLoad(function () {
		var filesystem;

		var cwd = dojo.byId('cwd');
		var ls = dojo.byId('ls');

		var update = function (hash) {
			dojo.empty(ls);

			var fullPath = dojo.queryToObject(hash).fullPath;

			filesystem.root.getDirectory(fullPath, null, function (entry) {
				cwd.innerHTML = entry.fullPath;

				entry.getParent(function (parent) {
					var item = dojo.create('li', null, ls);

					dojo.create('a', {
						href: '#' + dojo.objectToQuery({
							fullPath: parent.fullPath
						}),
						innerHTML: '..'
					}, item, 'first');
					
					var reader = entry.createReader();

					var successCallback = function (entries) {
						entries.forEach(function (entry) {
							var item = dojo.create('li', null, ls);

							if (entry.isFile)
								item.innerHTML = entry.name;
							else if (entry.isDirectory)
								dojo.create('a', {
									href: '#' + dojo.objectToQuery({
										fullPath: entry.fullPath
									}),
									innerHTML: entry.name
								}, item);
						});

						if (entries.length > 0)
							reader.readEntries(successCallback, errorCallback);
					};

					var errorCallback = function (error) {
						alert("Error reading directory (#" + error.code + ")");
					};

					reader.readEntries(successCallback, errorCallback);
				}, function (error) {
					alert("Error retrieving parent directory (#" + error.code + ")");
				});
			}, function (error) {
				alert("Error retrieving directory entry (#" + error.code + ")");
			});
		}

		dojo.subscribe("/dojo/hashchange", update);

		webinos.ServiceDiscovery.findServices("LocalFileSystem", {
			onFound: function (service) {
				service.bind(function () {
					/*service.requestFileSystem(webinos.file.LocalFileSystem.PERSISTENT, 1024, function (_filesystem) {
						filesystem = _filesystem;

						if (dojo.hash() == '')
							dojo.hash(dojo.objectToQuery({
								fullPath: filesystem.root.fullPath
							}));

						update(dojo.hash());
					}, function (error) {
						alert("Error requesting filesystem (#" + error.code + ")");
					});*/
				});
			}
		});
	});
</script>


</head>
<body>
<div class="pzh-pzp">
<div id = "tabs">
	<ul>
		<li> <a href="#pzh"> PZH </a> </li>
		<li> <a href="#pzp"> PZP </a> </li>
		<li> <a href="#example"> Example </a> </li>
	</ul>

	<div id = "pzh">
		<table>
			<p> PZH Connecting Details (If you want to start second PZH server, please change above config values) </p>
			<tr><th>Config </th> <th> Value </th> </tr>

			<tr><td>Country </td><td><input type="text" id="country" value="UK"/></td>
			<tr><td>State</td><td> <input type="text" id="state" value="TW"/></td>
			<tr><td>City </td><td><input type="text" id="city" value="ST"/></td>
			<tr><td>Org </td><td><input type="text" id="org" value="Webinos"/></td>
			<tr><td>OrgUnit </td><td><input type="text" id="orgunit" value="WP4"/></td>
			<tr><td>Common</td><td> <input type="text" id="common" value="habib@virji"/></td>
			<tr><td>Email </td><td><input type="text" id="email" value="internal@webinos.org"/></td>
			<tr><td>Days</td><td> <input type="text" id="days" value="180"/></td>
	
			<tr><td>Server Name </td><td><input type="text" id="servername" value="localhost"/></td></tr>
			<tr><td>Server Port </td><td><input type="text" id="serverport" value="442"/></td></tr>
			<tr><td>HTTPS Server Port</td><td> <input type="text" id="httpport" value="8907"/></td></tr>
			<tr><td><button id="startPZH">Start PZH </button></td></tr>
		</table>
	</div>
	<div id = "pzp">	
		<table>
			<tr><th>Config </th> <th> Value </th> </tr>

			<tr><td>Country </td><td><input type="text" id="pzpcountry" value="UK"/></td>
			<tr><td>State</td><td> <input type="text" id="pzpstate" value="TW"/></td>
			<tr><td>City </td><td><input type="text" id="pzpcity" value="ST"/></td>
			<tr><td>Org </td><td><input type="text" id="pzporg" value="Webinos"/></td>
			<tr><td>OrgUnit </td><td><input type="text" id="pzporgunit" value="WP4"/></td>
			<tr><td>Common</td><td> <input type="text" id="pzpcommon" value="PC"/></td>
			<tr><td>Email </td><td><input type="text" id="pzpemail" value="internal@webinos.org"/></td>
			<tr><td>Days</td><td> <input type="text" id="pzpdays" value="180"/></td>

	
			<tr><td>PZH Address </td><td><input type="text" id="pzpservername" value="localhost"/></td>
			<tr><td>PZH Port </td><td><input type="text" id="pzpserverport" value="442"/></td>
			<tr><td>PZP Server Port Number</td><td><input type="text" id="pzpport" value="9002"/></td>
			<tr><td><button id="startPZP">Start PZP </button></td></tr>
		</table>
	</div>

	<div id = "example">
		<table>
			<tr>
				<td>
					<button id="registerBrowser">Register Browser </button>
					<button id="findService">Find Service</button>
					<button id="get42PZP">get42PZP</button>
					<button id="get42PZPtoPZH">get42PZPtoPZH</button>
					<button id="get42PZPtoPZHtoPZP">get42PZPtoPZHtoPZP</button>
					<button id="get42PZPtoPZHtoPZH">get42PZPtoPZHtoPZH</button>
					<button id="get42PZPtoPZHtoPZHtoPZP">get42PZPtoPZHtoPZHtoPZP</button>
				</td>
			</tr>
		</table>
	</div>	
</div>
</div>
</body>
</html>
